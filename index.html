<!DOCTYPE html>
<html>
    
<head>
    <title>Volkswagen AR App Admin Panel</title>
    
    <link rel="stylesheet" type="text/css" href="Styles.css">
    
    <script>

    //create account functionality
    function createAccountDatabase() {
        event.preventDefault();
            
        var username = document.getElementById('username').value;
        var password = document.getElementById('password').value;
        var confirmPassword = document.getElementById('confirmPassword').value;

        if (password !== confirmPassword) {
            alert("Passwords do not match. Please try again.");
        } else {
            var url = "https://jwpoyq5nsnvbefkomgqojmoqxu0gxhcr.lambda-url.us-east-2.on.aws/?UserID=" + username + "&Password=" + password + "&Color=Violet";
            fetch(url, {
                method: 'POST'
            }).then(response => {
                console.log('Request sent successfully');
            }).catch(error => {
                console.error('Error sending request:', error);
            });
            alert("Account Created Successfully");
        }

    }

    //upload model to database functionality
    function uploadModel(){

        event.preventDefault();
            
        var modelName = document.getElementById('modelName').value;
        var modelUrl = document.getElementById('modelUrl').value;
        var websiteUrl = document.getElementById('websiteUrl').value;
        var type = document.getElementById('type').value;
        var location = document.getElementById('location').value;
        
        var car = '1';
        if (type == 'accessory'){
            car = '0';
        }

        var loc = '0';
        if (car == '0'){
            if (location == 'tleft'){
                loc = '1';
            }else if (location == 'tmiddle'){
                loc = '2';
            }else if (location == 'tright'){
                loc = '3';
            }
        }
            
        var url = "https://czenhyigbsqohlv74ihu2jzj6a0wfbrw.lambda-url.us-east-2.on.aws/?Modelname=" + modelName + "&Modelkey=" + "modelUrl" + "&Car=" + car + "&VWURL=" + websiteUrl + "&Location=" + loc;
        console.log(url);
        fetch(url, {
            method: 'POST'
        }).then(response => {
            console.log('Request sent successfully');
        }).catch(error => {
            console.error('Error sending request:', error);
        });
        alert("Model Uploaded");

        updateTable()
    }

    //function that adds rows to the table
    function addRow(name, mUrl, wUrl, type, loc) {
        var table = document.getElementById("database-table");
        var row = table.insertRow(table.rows.length);
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        var cell3 = row.insertCell(2);
        var cell4 = row.insertCell(3);
        var cell5 = row.insertCell(4);
        var cell6 = row.insertCell(5);
        cell1.innerHTML = name;
        cell2.innerHTML = '<a href="' + mUrl + '">Download ' + name + '</a>';
        if (wUrl == "N/A"){
            cell3.innerHTML = "N/A";
        }else{
            cell3.innerHTML = '<a href="' + wUrl + '">Link to ' + name + '</a>';
        }
        cell4.innerHTML = type;
        cell5.innerHTML = loc;
        cell6.innerHTML = '<span style="color: red; text-decoration: underline; cursor: pointer;" onclick="deleteModel(\'' + name + '\', \'' + type + '\')">Delete</span>';
    }

    function deleteModel(name, type){
        event.preventDefault();

        var car = '1';
        if (type == 'Accessory'){
            car = '0';
        }
        console.log(name, type);
        
        var url = "https://wxc2gyog5w3wdnosa5nzzfmytm0fscfu.lambda-url.us-east-2.on.aws/?Modelname=" + name + "&Car=" + car;
        console.log(url);
        fetch(url, {
            method: 'POST'
        }).then(response => {
            console.log('Request sent successfully');
        }).catch(error => {
            console.error('Error sending request:', error);
        });
        alert("Model Deleted");

        updateTable();
    }

    //function that clears all rows from table, then updates it
    //called after a model is uploaded so the table updates without having to refresh the page
    function updateTable() {
        //clears table
        var table = document.getElementById("database-table");
        var rowCount = table.rows.length;
        for (var i = rowCount - 1; i > 0; i--) {
            table.deleteRow(i);
        }
        //refills table with updated info
        requestJSON(requestUrl);
    }

    //parse the data currently in the table, then add to the table
    const requestUrl = 'https://clrddiepd6pcxqmj5jscpg6cki0capjo.lambda-url.us-east-2.on.aws/'
    var data;
    const requestJSON = async url => {

        const response = await (await fetch(url)).json();

        data=response.data
       
        var dataLength = data.length;
        for (var i = 0; i < dataLength; i++) {
            var modelInfo = data[i];

            if (modelInfo[2] == '1'){
                //car
                addRow(modelInfo[0], modelInfo[1], modelInfo[3], "Car", "N/A");
            }else{
                //accessory
                var loc;
                if (modelInfo[4] == '1'){
                    loc = 'Top Left';
                }else if (modelInfo[4] == '2'){
                    loc = 'Top Middle';
                }else if (modelInfo[4] == '3'){
                    loc = 'Top Right';
                }
                addRow(modelInfo[0], modelInfo[1], "N/A", "Accessory", loc);
            }
        }
    }

    requestJSON(requestUrl);

    //TO DO
    //Fix errors for upload and create account
        //ERROR POPS UP ON CREATE ACCOUNT, UPLOAD AND DELETE FOR SAME PERMISSION REASONS AS VIEW WAS HAVING, FUNCTIONS FINE BUT FOR FIXED ERRORS NEED API FIXED/HEADER ADDED
    //Table stuff
        //allow editing directly from the table
            //use existing delete and upload functions for that and figure out how to make a row inputable on button click
        //allow alphabetical sorting/filtering on the table

    //THINGS DONE THIS WEEK
    //added dynamically updating table that pulls from url
    //created function that can add rows
    //function that updates the table on upload
    //changed the part of upload models to be a dropdown choice box for car or accessory
    //Delete functionality
    
    </script>

    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>
    
</head>
    
<body>

<!-- Header -->
<h1>Volkswagen AR App Admin Panel</h1>
<br>

<!-- Pictures/3D -->
<div class="image-container">
  <div>
    <img src="2023-08-volkswagen-logo.png" alt="Volkswagen Logo" style="width:50%;">
  </div>
  <div>
    <div class = "model-display">
        <model-viewer src="vwbuzz_low.glb" ar ar-modes="webxr scene-viewer quick-look" camera-controls shadow-intensity="1" scale="6 6 6"> </model-viewer>
    </div>
  </div>
</div>
<br>
    
<!-- View Database -->
<div class = "section-header">
    <p>View Database</p>
</div>
    
<table id='database-table'>
    <tr>
        <th>Model Name</th>
        <th>Model URL</th>
        <th>Website URL</th>
        <th>Type</th>
        <th>Accessory Location</th>
        <th>Delete Entry</th>
    </tr>
</table>

<br><br>
    
<div class = "section-header">
    <p>Upload Model</p>
</div>
<br>
    
<form>
    
    <div class = "input-boxes">
        <label for="modelName">Model Name: </label>
        <input type="text" id="modelName" name="modelName"><br><br>
    </div>

    <div class = "input-boxes">
        <label for="modelUrl">Model URL: </label>
        <input type="text" id="modelUrl" name="modelUrl"><br><br>
    </div>

    <div class = "input-boxes">
        <label for="websiteUrl">Website URL (Only for Car Models): </label>
        <input type="text" id="websiteUrl" name="websiteUrl"><br><br>
    </div>

    <div class = "input-boxes">
        <label for="type">Type: </label>
        <select id="type" name="type">
            <option value="car">Car</option>
            <option value="accessory">Accessory</option>
        </select><br><br>
    </div>

    <div class = "input-boxes">
        <label for="location">Accessory Location (Select N/A if model is a Car): </label>
        <select id="location" name="location">
            <option value="na">Not Applicable</option>
            <option value="tleft">Top Left</option>
            <option value="tmiddle">Top Middle</option>
            <option value="tright">Top Right</option>
        </select><br><br>
    </div>

<button onclick="uploadModel()">Upload Model</button>

</form>

<br><br>

<!-- Create User Account -->
<div class = "section-header">
    <p>Create User Account</p>
</div>
<br>
    
<form>
    
    <div class = "input-boxes">
        <label for="username">Username: </label>
        <input type="text" id="username" name="username"><br><br>
    </div>

    <div class = "input-boxes">
        <label for="password">Password: </label>
        <input type="password" id="password" name="password"><br><br>
    </div>

    <div class = "input-boxes">
        <label for="confirmPassword">Confirm Password: </label>
        <input type="password" id="confirmPassword" name="confirmPassword"><br><br>
    </div>

<button onclick="createAccountDatabase()">Create Account</button>

</form>
    
</body>
    
</html>
