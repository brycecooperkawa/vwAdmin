<!DOCTYPE html>
<html>
    
<head>
    <title>Volkswagen AR App Admin Panel</title>
    
    <link rel="stylesheet" type="text/css" href="Styles.css">
    
    <script>

    //create account functionality
    function createAccountDatabase() {
        event.preventDefault();
            
        var username = document.getElementById('username').value;
        var password = document.getElementById('password').value;
        var confirmPassword = document.getElementById('confirmPassword').value;

        if (password !== confirmPassword) {
            alert("Passwords do not match. Please try again.");
        } else {
            var url = "https://hjwtamibcy4jtpa5u6uzdbg4za0jwvwf.lambda-url.us-east-2.on.aws/?UserID=" + username + "&Password=" + password + "&Color=Green&Login=True&Modelname=" + null + "&TopLeft=" + null + "&TopMiddle=" + null + "&TopRight=" + null;
            fetch(url, {
                method: 'POST'
            }).then(response => {
                console.log('Request sent successfully');
            }).catch(error => {
                console.error('Error sending request:', error);
            });
            alert("Account Created Successfully");
        }

        //clear/reset form
        document.getElementById('username').value = "";
        document.getElementById('password').value = "";
        document.getElementById('confirmPassword').value = "";

    }

    //upload model to database functionality
    function uploadModel(){

        event.preventDefault();

        //get info from the html form
        var modelName = document.getElementById('modelName').value;
        var modelUrl = document.getElementById('modelUrl').value;
        var websiteUrl = document.getElementById('websiteUrl').value;
        var type = document.getElementById('type').value;
        var location = document.getElementById('location').value;
        
        var car = '1';
        var check = 1;
        if (type == 'accessory'){
            car = '0';
        }else if (type == ""){
            check = 0;
        }

        var loc = '0';
        if (car == '0'){
            if (location == 'tleft'){
                loc = '1';
            }else if (location == 'tmiddle'){
                loc = '2';
            }else if (location == 'tright'){
                loc = '3';
            }
        }

        if (modelName == ""){
            check = 2;
        }else if (modelUrl == ""){
            check = 3;
        }

        if (check == 1){
            var url = "https://czenhyigbsqohlv74ihu2jzj6a0wfbrw.lambda-url.us-east-2.on.aws/?Modelname=" + modelName + "&Modelkey=" + "modelUrl" + "&Car=" + car + "&VWURL=" + websiteUrl + "&Location=" + loc;
            console.log(url);
            fetch(url, {
                method: 'POST'
            }).then(response => {
                console.log('Request sent successfully');
            }).catch(error => {
                console.error('Error sending request:', error);
            });
            alert("Model Uploaded");

            //clear/reset form
            document.getElementById('modelName').value = "";
            document.getElementById('modelUrl').value = "";
            document.getElementById('websiteUrl').value = "";

            var typeDropdown = document.getElementById('type');
            typeDropdown = "";
            var locationDropdown = document.getElementById('location');
            locationDropdown = "tleft";

            //Wait 5 seconds before updating table
            setTimeout(function() {
                updateTable();
            }, 5000);
            
        }else if (check == 0){
            alert("Please select a model type and try again.");
        }else if (check == 2){
            alert("Please enter a model name and try again.");
        }else if (check == 3){
            alert("Please enter a model S3 url and try again.");
        }
        
    }

    //function that adds rows to the table
    function addRow(name, mUrl, wUrl, type, loc) {
        var table = document.getElementById("database-table");
        var row = table.insertRow(table.rows.length);
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        var cell3 = row.insertCell(2);
        var cell4 = row.insertCell(3);
        var cell5 = row.insertCell(4);
        var cell6 = row.insertCell(5);
        var cell7 = row.insertCell(6);
        cell1.innerHTML = name;
        cell2.innerHTML = '<a href="' + mUrl + '">Download ' + name + '</a>';
        if (wUrl == "Michael Jeffery Jordan"){
            cell3.innerHTML = "N/A";
        }else{
            cell3.innerHTML = '<a href="' + wUrl + '">Link to ' + name + '</a>';
        }
        cell4.innerHTML = type;
        cell5.innerHTML = loc;
        cell6.innerHTML = '<span style="color: red; text-decoration: underline; cursor: pointer;" onclick="deleteModel(\'' + name + '\', \'' + type + '\')">Delete</span>';
        cell7.innerHTML = '<span style="color: blue; text-decoration: underline; cursor: pointer;" onclick="editModel(\'' + (table.rows.length - 1) + '\')">Edit</span>';
    }

    function deleteModel(name, type){
        var confirmed = confirm("Are you sure you want to delete the " + name + " model?");
        if (confirmed) {
            //prefrom deletion
            event.preventDefault();

            var car = '1';
            if (type == 'Accessory'){
                car = '0';
            }
        
            var url = "https://wxc2gyog5w3wdnosa5nzzfmytm0fscfu.lambda-url.us-east-2.on.aws/?Modelname=" + name + "&Car=" + car;

            fetch(url, {
                method: 'POST'
            }).then(response => {
                console.log('Request sent successfully');
            }).catch(error => {
                console.error('Error sending request:', error);
            });
            alert(name + " has been deleted.");

            //Wait 5 seconds before updating table
            setTimeout(function() {
                updateTable();
            }, 5000);
            
        } else {
            //delete canceled
            alert("Deletion of " + name + " was cancelled.");
        }
    }

    //on edit cell click, make the row editable
    //edit becomes a save which then takes you to save
    function editModel(rowId) {
        //get table and the row
        var table = document.getElementById("database-table");
        var row = table.rows[rowId];

        //get all cells from the row and make them editable
        for (var i = 0; i < row.cells.length - 2; i++) {
            var cell = row.cells[i];
            var cellData = cell.innerHTML;

            //if cell is modelurl/websiteurl
                //set cell to clear
                //ex: cell2.innerHTML = '';
                //then make it an input
                //then send it to saveModel function
                    //in saveModel function turn it back into a real url
                    //ex: cell3.innerHTML = '<a href="' + wUrl + '">Link to ' + name + '</a>';

            //if cell is type/location do something similar, try to make it a dropdown instead of a input box

            //make the cell an input
            cell.innerHTML = '<input type="text" value="' + cellData + '">';
        }

        var editCell = row.cells[row.cells.length - 1];
        console.log(editCell.innerHTML);
        editCell.innerHTML = '<span style="color: green; text-decoration: underline; cursor: pointer;" onclick="saveModel(' + rowNumber + ')">Save</span>';
        console.log(editCell.innerHTML);
    }

    function saveModel(rowNumber){
        console.log("Hello");
    }

    //function that clears all rows from table, then updates it
    //called after a model is uploaded so the table updates without having to refresh the page
    function updateTable() {
        //clears table
        var table = document.getElementById("database-table");
        var rowCount = table.rows.length;
        for (var i = rowCount - 1; i > 0; i--) {
            table.deleteRow(i);
        }
        //refills table with updated info
        requestJSON(requestUrl);
    }

    //parse the data currently in the table, then add to the table
    const requestUrl = 'https://clrddiepd6pcxqmj5jscpg6cki0capjo.lambda-url.us-east-2.on.aws/';
    var data;
    const requestJSON = async url => {

        const response = await (await fetch(url)).json();

        data=response.data;
       
        var dataLength = data.length;
        for (var i = 0; i < dataLength; i++) {
            var modelInfo = data[i];

            if (modelInfo[2] == '1'){
                //car
                addRow(modelInfo[0], modelInfo[1], modelInfo[3], "Car", "N/A");
            }else{
                //accessory
                var loc;
                if (modelInfo[4] == '1'){
                    loc = 'Top Left';
                }else if (modelInfo[4] == '2'){
                    loc = 'Top Middle';
                }else if (modelInfo[4] == '3'){
                    loc = 'Top Right';
                }
                addRow(modelInfo[0], modelInfo[1], "N/A", "Accessory", loc);
            }
        }
    }

    requestJSON(requestUrl);

    function optionsToggle() {
        var type = document.getElementById('type').value;
        var websiteUrlField = document.getElementById('websiteUrlField');
        var locationField = document.getElementById('locationField');

        if (type == 'car') {
            websiteUrlField.style.display = 'block';
            locationField.style.display = 'none';
            document.getElementById('location').value = '0';
            document.getElementById('websiteUrl').value = "";
        } else if (type == 'accessory') {
            websiteUrlField.style.display = 'none';
            locationField.style.display = 'block';
            document.getElementById('websiteUrl').value = "Michael Jeffery Jordan";
        }
    }

    //TO DO
    //Fix errors for upload and create account
        //make the upload and create account alerts be specialized similar to delete ie. VWBUZZ was uploaded/Bryce account was created.
    //Table stuff
        //allow editing directly from the table
            //rows being inputable and then confirm to edit an entry directly
        //allow alphabetical sorting/filtering on the table
    //try and get upload and create account to clear the forms on enter without breaking it
    //and comments to code
    //DOUBLE CHECK THAT THE ADMIN PANEL WORKS EVERYTIME
        //Delete sometimes takes two clicks before it works
        //Refresh normally fixes this, add a refresh table button
            //Or have a function running every 10 sec in background checking for table growth or shrink then call update table
            //or make the upload and delete wait a little before updating table

    //THINGS DONE THIS WEEK
    //Upload form updates based on type
    
    </script>

    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>
    
</head>
    
<body>

<!-- Header -->
<h1>Volkswagen AR App Admin Panel</h1>
<br>

<!-- Pictures/3D -->
<div class="image-container">
  <div>
    <img src="2023-08-volkswagen-logo.png" alt="Volkswagen Logo" style="width:50%;">
  </div>
  <div>
    <div class = "model-display">
        <model-viewer src="vwbuzz_low.glb" ar ar-modes="webxr scene-viewer quick-look" camera-controls shadow-intensity="1" scale="6 6 6"> </model-viewer>
    </div>
  </div>
</div>
<br>
    
<!-- View Database -->
<div class = "section-header">
    <p>View Database</p>
</div>
    
<table id='database-table'>
    <tr>
        <th>Model Name</th>
        <th>Model URL</th>
        <th>Website URL</th>
        <th>Type</th>
        <th>Accessory Location</th>
        <th>Delete Entry</th>
        <th>Edit Entry</th>
    </tr>
</table>

<br><br>
    
<div class = "section-header">
    <p>Upload Model</p>
</div>
<br>
    
<form>
    
    <div class = "input-boxes">
        <label for="modelName">Model Name: </label>
        <input type="text" id="modelName" name="modelName"><br><br>
    </div>

    <div class = "input-boxes">
        <label for="modelUrl">Model URL: </label>
        <input type="text" id="modelUrl" name="modelUrl"><br><br>
    </div>

    <div class = "input-boxes">
        <label for="type">Type: </label>
        <select id="type" name="type" onchange="optionsToggle()">
            <option value="">Please select an option.</option>
            <option value="car">Car</option>
            <option value="accessory">Accessory</option>
        </select><br><br>
    </div>

    <div class = "input-boxes" id="websiteUrlField">
        <label for="websiteUrl">Website URL: </label>
        <input type="text" id="websiteUrl" name="websiteUrl"><br><br>
    </div>

    <div class = "input-boxes" id="locationField">
        <label for="location">Accessory Location: </label>
        <select id="location" name="location">
            <option value="tleft">Top Left</option>
            <option value="tmiddle">Top Middle</option>
            <option value="tright">Top Right</option>
        </select><br><br>
    </div>

<button onclick="uploadModel()">Upload Model</button>

</form>

<br><br>

<!-- Create User Account -->
<div class = "section-header">
    <p>Create User Account</p>
</div>
<br>
    
<form>
    
    <div class = "input-boxes">
        <label for="username">Username: </label>
        <input type="text" id="username" name="username"><br><br>
    </div>

    <div class = "input-boxes">
        <label for="password">Password: </label>
        <input type="password" id="password" name="password"><br><br>
    </div>

    <div class = "input-boxes">
        <label for="confirmPassword">Confirm Password: </label>
        <input type="password" id="confirmPassword" name="confirmPassword"><br><br>
    </div>

<button onclick="createAccountDatabase()">Create Account</button>

</form>
    
</body>
    
</html>
