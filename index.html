<!DOCTYPE html>
<html>
    
<head>
    <title>Volkswagen AR App Admin Panel</title>
    
    <link rel="stylesheet" type="text/css" href="Styles.css">
    
    <script>

    //create account functionality
    function createAccountDatabase() {
        //avoid changing the url with normal form submission
        event.preventDefault();

        //get the necessary info from the html form
        var username = document.getElementById('username').value;
        var password = document.getElementById('password').value;
        var confirmPassword = document.getElementById('confirmPassword').value;

        //check that passwords match before attempting account creation
        if (password !== confirmPassword) {
            alert("Passwords do not match. Please try again.");
        //if passwords match then create the account
        } else {
            var url = "https://hjwtamibcy4jtpa5u6uzdbg4za0jwvwf.lambda-url.us-east-2.on.aws/?UserID=" + username + "&Password=" + password + "&Color=Green&Login=True&Modelname=" + null + "&TopLeft=" + null + "&TopMiddle=" + null + "&TopRight=" + null;
            fetch(url, {
                method: 'POST'
            }).then(response => {
                console.log('Request sent successfully');
            }).catch(error => {
                console.error('Error sending request:', error);
            });
            alert("Account Created Successfully");
        }

        //clear/reset form
        document.getElementById('username').value = "";
        document.getElementById('password').value = "";
        document.getElementById('confirmPassword').value = "";
    }

    //upload model to database functionality
    function uploadModel(){
        //avoid normal form submission
        event.preventDefault();

        //get info from the html form
        var modelName = document.getElementById('modelName').value;
        var modelUrl = document.getElementById('modelUrl').value;
        var websiteUrl = document.getElementById('websiteUrl').value;
        var type = document.getElementById('type').value;
        var location = document.getElementById('location').value;
        var image = document.getElementById('modelImage').value;

        //convert the text to the "bool", 1 for car model, 0 for accessory model
        var car = '1';
        //variable check to check all inputs as vaild
        var check = 1;
        if (type == 'accessory'){
            car = '0';
        //if the type is 0 set the check variable to 0 for set type alert
        }else if (type == ""){
            check = 0;
        }

        //convert the location values to loc so they can be used in the url
        var loc = '0';
        if (car == '0'){
            if (location == 'tleft'){
                loc = '1';
            }else if (location == 'tmiddle'){
                loc = '2';
            }else if (location == 'tright'){
                loc = '3';
            }
        }

        //check for modelName and modelUrl being entered, if not then alert user using check
        if (modelName == ""){
            check = 2;
        }else if (modelUrl == ""){
            check = 3;
        }else if (image == ""){
            check = 4;
        }

        //if check is one everything is entered, now upload the model
        if (check == 1){
            var url = "https://czenhyigbsqohlv74ihu2jzj6a0wfbrw.lambda-url.us-east-2.on.aws/?Modelname=" + modelName + "&Modelkey=" + modelUrl + "&Car=" + car + "&VWURL=" + websiteUrl + "&Location=" + loc + "&Image=" + image;
            console.log(url);
            fetch(url, {
                method: 'POST'
            }).then(response => {
                console.log('Request sent successfully');
            }).catch(error => {
                console.error('Error sending request:', error);
            });
            alert("Model Uploaded");

            //clear/reset form
            document.getElementById('modelName').value = "";
            document.getElementById('modelUrl').value = "";
            document.getElementById('websiteUrl').value = "";
            document.getElementById('modelImage').value = "";
            var typeDropdown = document.getElementById('type');
            typeDropdown = "";
            var locationDropdown = document.getElementById('location');
            locationDropdown = "tleft";

            //Wait 5 seconds before updating table
            setTimeout(function() {
                updateTable();
            }, 5000);

        //check fail alerts
        }else if (check == 0){
            alert("Please select a model type and try again.");
        }else if (check == 2){
            alert("Please enter a model name and try again.");
        }else if (check == 3){
            alert("Please enter a model S3 url and try again.");
        }else if (check == 4){
            alert("Please enter a model image and try again.");
        }
        
    }

    //function that adds rows to the table
    function addRow(name, mUrl, wUrl, type, loc, mImage) {
        //get the table
        var table = document.getElementById("database-table");
        
        //create a row and the cells to insert in that row
        var row = table.insertRow(table.rows.length);
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        var cell3 = row.insertCell(2);
        var cell8 = row.insertCell(3);
        var cell4 = row.insertCell(4);
        var cell5 = row.insertCell(5);
        var cell6 = row.insertCell(6);
        var cell7 = row.insertCell(7);

        //fill out the cells
        cell1.innerHTML = name;
        cell2.innerHTML = '<a href="' + mUrl + '">Download ' + name + '</a>';
        //if accessory then set the display to N/A
        if (wUrl == "MichaelJefferyJordan" || wUrl == "KobeBeanBryant" || wUrl == "N/A"){
            cell3.innerHTML = "N/A";
        //if car set as link
        }else{
            cell3.innerHTML = '<a href="' + wUrl + '">Link to ' + name + '</a>';
        }
        cell4.innerHTML = type;
        cell5.innerHTML = loc;
        //delete button that takes model name and type
        cell6.innerHTML = '<span style="color: red; text-decoration: underline; cursor: pointer;" onclick="deleteModel(\'' + name + '\', \'' + type + '\')">Delete</span>';
        //edit button that takes row number, modelUrl, webUrl
        cell7.innerHTML = '<span style="color: blue; text-decoration: underline; cursor: pointer;" onclick="editModel(\'' + (table.rows.length - 1) +  '\', \'' + mUrl + '\', \'' + wUrl + '\', \'' + mImage + '\')">Edit</span>';
        if (mImage == "" || mImage == "N/A"){
            cell8.innerHTML = "N/A";
        }else{
            cell8.innerHTML = '<a href="' + mImage + '">View ' + name + ' Image' + '</a>';
        }
    }

    //deletes the model from the database
    function deleteModel(name, type){
        //ask the user if they want to delete model
        var confirmed = confirm("Are you sure you want to delete the " + name + " model?");
        //prefrom deletion
        if (confirmed) {
            event.preventDefault();

            //get the proper var for the url from the type var
            var car = '1';
            if (type == 'Accessory'){
                car = '0';
            }
        
            var url = "https://wxc2gyog5w3wdnosa5nzzfmytm0fscfu.lambda-url.us-east-2.on.aws/?Modelname=" + name + "&Car=" + car;

            fetch(url, {
                method: 'POST'
            }).then(response => {
                console.log('Request sent successfully');
            }).catch(error => {
                console.error('Error sending request:', error);
            });
            alert(name + " has been deleted.");

            //wait 5 seconds before updating table
            setTimeout(function() {
                updateTable();
            }, 5000);
            
        } else {
            //delete canceled
            alert("Deletion of " + name + " was cancelled.");
        }
    }

    //on edit cell click, make the row editable
    //edit becomes a save which then takes you to save
    function editModel(rowId, mUrl, wUrl, mImage) {
        //get table and the row
        var table = document.getElementById("database-table");
        var row = table.rows[rowId];

        //get original name to pass to save for delete functionality
        var origName = row.cells[0].innerHTML;

        //based on the type, select which cells are editable or not
        var typeCell = row.cells[row.cells.length - 4];
        var check = 1;
        if (typeCell.innerHTML == "Accessory"){
            check = 0;
        }

        //loop thru all cells and make them editable
        for (var i = 0; i < row.cells.length - 2; i++) {
            var cell = row.cells[i];
            var cellData = cell.innerHTML;

            //sets the cells as text entries if they should be
            if (i == 0){
                cell.innerHTML = '<input type="text" id="editModelName" name="editModelName" value="' + cellData + '">';
            }else if (i == 1){
                cell.innerHTML = '<input type="text" id="editModelUrl" name="editModelUrl" value="' + mUrl + '">';
            }else if (i == 2 && check == 1){
                cell.innerHTML = '<input type="text" id="editWebUrl" name="editWebUrl" value="' + wUrl + '">';
            }else if (i == 5 && check == 0){
                cell.innerHTML = '<select id="editLocation" name="editLocation"> <option value="tleft">Top Left</option> <option value="tmiddle">Top Middle</option> <option value="tright">Top Right</option> </select>';
            }else if (i == 3 && check == 1){
                cell.innerHTML = '<input type="text" id="editImage" name="editImage" value="' + mImage + '">';
            }
            
        }

        //change edit option to save/cancel
        var editCell = row.cells[row.cells.length - 1];
        editCell.innerHTML = '<span style="color: green; text-decoration: underline; cursor: pointer;" onclick="saveEditModel(\'' + rowId +  '\', \'' + origName +  '\')">Save</span>' +
            '<span style="color: red; text-decoration: underline; cursor: pointer; margin-left: 10px;" onclick="updateTable()">Cancel</span>';
    }

    //function called by save button that edit turns into
    //used to update the model in the database
    function saveEditModel(rowId, origName){
        //get table and row
        var table = document.getElementById("database-table");
        var row = table.rows[rowId];

        var typeCell = row.cells[row.cells.length - 4];
        //get the type of the cell being saved
        var type = typeCell.innerHTML;

        //get the inputs that are model type specific
        var websiteUrl = "KobeBeanBryant";
        var editLocation = "OdellBeckhamJr";
        var modelImage = "EliManning";
        if (document.getElementById('editLocation') != null){
            editLocation = document.getElementById('editLocation').value;
        }
        var loc = '0';
        var car = '1';
        if (type == "Car"){
            websiteUrl = document.getElementById('editWebUrl').value;
            modelImage = document.getElementById('editImage').value;
        }else{
            if (editLocation == 'tleft'){
                loc = '1';
            }else if (editLocation == 'tmiddle'){
                loc = '2';
            }else if (editLocation == 'tright'){
                loc = '3';
            }
            car = '0';
        }

        var modelName = document.getElementById('editModelName').value;
        var modelUrl = document.getElementById('editModelUrl').value;

        //check to make sure that modelName and modelUrl are not left blank
        var check = 1;
        if (modelName == ""){
            check = 2;
        }else if (modelUrl == ""){
            check = 3;
        }else if (modelImage == ""){
            check = 4;
        }

        if (check == 1){
            //prefrom deletion of model before edit
            event.preventDefault();
        
            var url = "https://wxc2gyog5w3wdnosa5nzzfmytm0fscfu.lambda-url.us-east-2.on.aws/?Modelname=" + origName + "&Car=" + car;

            fetch(url, {
                method: 'POST'
            }).then(response => {
                console.log('Request sent successfully');
            }).catch(error => {
                console.error('Error sending request:', error);
            });

            //upload model with edits
            url = "https://czenhyigbsqohlv74ihu2jzj6a0wfbrw.lambda-url.us-east-2.on.aws/?Modelname=" + modelName + "&Modelkey=" + modelUrl + "&Car=" + car + "&VWURL=" + websiteUrl + "&Location=" + loc + "&Image=" + modelImage;
            fetch(url, {
                method: 'POST'
            }).then(response => {
                console.log('Request sent successfully');
            }).catch(error => {
                console.error('Error sending request:', error);
            });
            alert("Model Updated");

            //Wait 5 seconds before updating table
            setTimeout(function() {
                updateTable();
            }, 5000);
            
        }else if (check == 2){
            alert("Please enter a model name and try again.");
        }else if (check == 3){
            alert("Please enter a model S3 url and try again.");
        }else if (check == 4){
            alert("Please enter a model image and try again.");
        }
        
    }

    //function that clears all rows from table, then updates it
    //called after a model is uploaded so the table updates without having to refresh the page
    function updateTable() {
        //clears table
        var table = document.getElementById("database-table");
        var rowCount = table.rows.length;
        for (var i = rowCount - 1; i > 0; i--) {
            table.deleteRow(i);
        }
        //refills table with updated info
        requestJSON(requestUrl);
    }

    //parse the data currently in the table, then add to the table
    const requestUrl = 'https://clrddiepd6pcxqmj5jscpg6cki0capjo.lambda-url.us-east-2.on.aws/';
    var data;
    const requestJSON = async url => {

        const response = await (await fetch(url)).json();

        data=response.data;
       
        var dataLength = data.length;
        for (var i = 0; i < dataLength; i++) {
            var modelInfo = data[i];

            //based on if listed as car or accessory send addRow diff things
            if (modelInfo[2] == '1'){
                //car
                addRow(modelInfo[0], modelInfo[1], modelInfo[3], "Car", "N/A", modelInfo[5]);
            }else{
                //accessory
                var loc;
                if (modelInfo[4] == '1'){
                    loc = 'Top Left';
                }else if (modelInfo[4] == '2'){
                    loc = 'Top Middle';
                }else if (modelInfo[4] == '3'){
                    loc = 'Top Right';
                }
                addRow(modelInfo[0], modelInfo[1], "N/A", "Accessory", loc, "N/A");
            }
        }
    }

    requestJSON(requestUrl);

    //based on which type is selected in the form, display different options
    function optionsToggle() {
        //get the type and the fields that will or won't be shown
        var type = document.getElementById('type').value;
        var websiteUrlField = document.getElementById('websiteUrlField');
        var locationField = document.getElementById('locationField');
        var imageField = document.getElementById('modelImageField');

        //if car show the webUrl, image, and hide the location
        if (type == 'car') {
            websiteUrlField.style.display = 'block';
            imageField.style.display = 'block';
            locationField.style.display = 'none';
            document.getElementById('location').value = '0';
            document.getElementById('websiteUrl').value = "";
            document.getElementById('modelImage').value = "";
        //if accessory vice versa
        } else if (type == 'accessory') {
            websiteUrlField.style.display = 'none';
            imageField.style.display = 'none';
            locationField.style.display = 'block';
            document.getElementById('websiteUrl').value = "MichaelJefferyJordan";
            document.getElementById('modelImage').value = "EliManning";
        }
    }

    //TO DO
    //Table stuff
        //allow alphabetical sorting/filtering on the table
        //if they edit something to have the same name as an existing model?
        //have the option of location that the acc was initally set to still display as the first option
    //split table into accessories and cars
    //split upload into upload car upload accessory
        //for upload car add ability to add colors and sim 3d positions (steering wheel positions if added)

    //THINGS DONE THIS WEEK
    //Upload form updates based on type
    //allow editing directly from the table
        //rows being inputable and then confirm to edit an entry directly
        //added save functionality from the table
        //added cancel of edit functionality
    //fixed form clearing
    //updated all functions to add image url column

    
    </script>
    
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>
    
</head>
    
<body>

<!-- Header -->
<h1>Volkswagen AR App Admin Panel</h1>
<br>

<!-- Pictures/3D -->
<div class="image-container">
  <div>
    <img src="2023-08-volkswagen-logo.png" alt="Volkswagen Logo" style="width:50%;">
  </div>
  <div>
    <div class = "model-display">
        <model-viewer src="vwbuzz_low.glb" ar ar-modes="webxr scene-viewer quick-look" camera-controls shadow-intensity="1" scale="6 6 6"> </model-viewer>
    </div>
  </div>
</div>
<br>
    
<!-- View Database -->
<div class = "section-header">
    <p>View Database</p>
</div>
    
<table id='database-table'>
    <tr>
        <th>Model Name</th>
        <th>Model URL</th>
        <th>Website URL</th>
        <th>Image URL</th>
        <th>Type</th>
        <th>Accessory Location</th>
        <th>Delete Entry</th>
        <th>Edit Entry</th>
    </tr>
</table>

<br><br>
    
<div class = "section-header">
    <p>Upload Model</p>
</div>
<br>
    
<form>
    
    <div class = "input-boxes">
        <label for="modelName">Model Name: </label>
        <input type="text" id="modelName" name="modelName"><br><br>
    </div>

    <div class = "input-boxes">
        <label for="modelUrl">Model URL: </label>
        <input type="text" id="modelUrl" name="modelUrl"><br><br>
    </div>

    <div class = "input-boxes">
        <label for="type">Type: </label>
        <select id="type" name="type" onchange="optionsToggle()">
            <option value="">Please select an option.</option>
            <option value="car">Car</option>
            <option value="accessory">Accessory</option>
        </select><br><br>
    </div>

    <div class = "input-boxes" id="websiteUrlField">
        <label for="websiteUrl">Website URL: </label>
        <input type="text" id="websiteUrl" name="websiteUrl"><br><br>
    </div>

    <div class = "input-boxes" id="locationField">
        <label for="location">Accessory Location: </label>
        <select id="location" name="location">
            <option value="tleft">Top Left</option>
            <option value="tmiddle">Top Middle</option>
            <option value="tright">Top Right</option>
        </select><br><br>
    </div>

    <div class = "input-boxes" id="modelImageField">
        <label for="modelImage">Model Image: </label>
        <input type="text" id="modelImage" name="modelImage"><br><br>
    </div>

<button onclick="uploadModel()">Upload Model</button>

</form>

<br><br>

<!-- Create User Account -->
<div class = "section-header">
    <p>Create User Account</p>
</div>
<br>
    
<form>
    
    <div class = "input-boxes">
        <label for="username">Username: </label>
        <input type="text" id="username" name="username"><br><br>
    </div>

    <div class = "input-boxes">
        <label for="password">Password: </label>
        <input type="password" id="password" name="password"><br><br>
    </div>

    <div class = "input-boxes">
        <label for="confirmPassword">Confirm Password: </label>
        <input type="password" id="confirmPassword" name="confirmPassword"><br><br>
    </div>

<button onclick="createAccountDatabase()">Create Account</button>

</form>
    
</body>
    
</html>
